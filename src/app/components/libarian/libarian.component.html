<app-navbar/>
@if(book_service.bookData()){
    <div class="flex  flex-col justify-center border items-center  md:w-[90%] w-full min-h-fit  m-auto pl-4 pr-4 pb-6 mt-12 shadow-md rounded-md">
        @if(!book_service.addBookBtnVisibility()){
            <app-add-book (bookDetail)="addBook($event)" (closeBtnOutput)="closeModel($event)"  [editModeValue]="book_service.editMode"/>
        }
        <div class="flex justify-between items-center mb-4 mt-4 pr-12  w-full">
          
           
            @if(book_service.addBookBtnVisibility()){
                <p class="text-lg font-mono bg-sky-400 h-8 rounded-md cursor-pointer flex justify-center items-center text-white p-2 " (click)="toggleAddBookBtnVisibility()" >Add Book</p>
            }
          
        </div>
        <table class="border-collapse   table-auto  w-full min-h-fit p-10">
            <caption class="caption-top mb-8">
                <input type="search" name="" id="search-input" [(ngModel)]="book_service.searchQuery" (input)="filterBooks()" placeholder="Search by book title" class="outline-none rounded-md border-2 border-gray-50   mb-5 p-2 shadow-2xl">
                <select name="" id="" [(ngModel)]="book_service.searchByGener" class="outline-none p-2 ml-4 shadow-xl rounded-md" (change)="filterBooks()">
                   <option value="All">All</option>
                   <option value="Science"  >Science</option>
                   <option value="History">History</option>
                   <option value="Politics">Politics</option>
                   <option value="Fiction">Fiction</option>
                   <option value="Geography">Geography</option>
                </select>
                <a routerLink="/otherbook" class="ml-5 text-sky-400">Other Book source -></a>
              </caption>
                    <tr>
                        <th class="">Book Author </th>
                        <th class="">Title</th>
                        <th class="">Category</th>
                        <th class="">Book ISBN </th>
                        <th class="">Published Date</th>
                        <th>Book age</th>
                        <th>Book Price</th>
                        <th class="">Book Status</th>
                        <th>Operation</th>
    
                    </tr>
                    @if(!book_service.searchQuery() && (book_service.searchByGener()==='All')){

                        @for(book of book_service.bookData();track  book.id){
                        <!-- @for(book of bookData();track  book.id){ -->
                                <tr class="">
                                    <td class="border-t  text-center h-16">{{book.bookAuthor}}</td>
                                    <td class="border-t  text-center h-16">{{book.bookTitle | titlecase}} </td>
                                    <td class="border-t  text-center h-16">{{book.bookGenere}}</td>
                                    <td class="border-t  text-center h-16">{{book.bookIsbn}}</td>
                                    <td class="border-t  text-center h-16">{{book.publishedDate | date}}</td>
                                    <td class="border-t  text-center h-16">{{calculateBookAge(book.publishedDate)}}</td>
                                    <td class="border-t  text-center h-16">{{book.price | currency}}</td>
                                     <td class="border-t text-center h-16  ">
                                        @if(book?.userId===book_service.currentUser().userId){
                                            <p class="cursor-pointer font-bold text-red-600">Issued by you</p>
                                        }@else if(!book.userId){
                                            <p class="cursor-pointer font-bold text-blue-600">Available</p>
                                        }@else {
                                            <p class="cursor-pointer font-bold text-green-600">Issued By Other</p>
                                        }
                                       
                                     </td>
                                     <td>
                                        <button class="bg-green-400 w-fit p-2 mr-2 rounded-md" (click)="editBook(book.id)">Edit</button>
                                        <button class="bg-red-500 w-fit p-2 rounded-md" (click)="deleteBook(book.id)">Delete</button>
                                     </td>
                                </tr>
                        }}@else if((book_service.searchByGener() || (book_service.searchQuery()!='All'))){
                                  @for(book of book_service.matchedBook();track book.id){
                                    <tr class="">
                                        <td class="border-t  text-center h-16">{{book.bookAuthor}}</td>
                                        <td class="border-t  text-center h-16">{{book.bookTitle | titlecase}}</td>
                                        <td class="border-t  text-center h-16">{{book.bookGenere}}</td>
                                        <td class="border-t  text-center h-16">{{book.bookIsbn}}</td>
                                        <td class="border-t  text-center h-16">{{book.publishedDate | date}}</td>
                                        <td class="border-t  text-center h-16">{{calculateBookAge(book.publishedDate)}}</td>
                                        <td class="border-t  text-center h-16">{{book.price | currency}}</td>
                                         <td class="border-t text-center h-16  ">
                                            @if(book.userId===book_service.currentUser().userId){
                                                <p class="cursor-pointer font-bold text-red-600">Issued by you</p>
                                            }@else if(!book.userId){
                                                <p class="cursor-pointer font-bold text-blue-600">Available</p>
                                            }@else {
                                                <p class="cursor-pointer font-bold text-green-600">Issued By Other</p>
                                            }
                                           
                                         </td>
                                         <td>
                                            <button class="bg-green-400 w-fit p-2 mr-2 rounded-md" (click)="editBook(book.id)">Edit</button>
                                            <button class="bg-red-500 w-fit p-2 rounded-md" (click)="deleteBook(book.id)">Delete</button>
                                         </td>
                                    </tr>
                                  }   
                        }
        </table>
    </div>
   
}

<router-outlet/>
